![logo](https://raw.githubusercontent.com/ChizhovVadim/CounterGo/master/logo.png)
# counterdev
counterdev - developer версия шахматного движка [Counter](https://github.com/ChizhovVadim/CounterGo).

## Сила игры
Рейтинг [CCRL 40/15](https://www.computerchess.org.uk/ccrl/4040/)
|Версия|Рейтинг|
|------|-------|
|Counter 5.0 64-bit 4CPU|3373|
|Counter 5.5 64-bit|3333|

## Отличия от основной версии
- работает на arm64 neon (Apple silicon) с использованием simd инструкций для нейросетевой оценочной функции.
- содержит несколько оценочных функций: только материал, HCE (hand crafted eval), нейросетевая оценка.
- кроме основного движка, есть упрощенный движок enginemini, который удобен для изучения алгоритмов перебора.
- поддержка формата PGN (Portable Game Notation)
- содержит дополнительные утилиты, которые используются при разработке движка, но не нужны для запуска самого движка

## Утилиты
- решение тактических тестов
- проведение матча между двумя движками
- вычисление ошибки оценочной функции на валидационном датасете
- генератор дебютов
- создание датасета для обучения нейронной сети
- обучение нейронной сети

## Машинное обучение
### Архитектура
Нейросеть для оценки позиций имеет простейшую структуру 768x512x1. Входных признаков 768: 12 фигур x 64 поля. Для обучения такой сети не требуется слишком большой датасет.
### Датасет
Для получения датасета, движок играет сам с собой большое количество партий. Считаем, что у нас уже есть обычная, не нейросетевая оценочная функция. Сыгранные партии сохраняются в PGN формате вместе с оценкой перебора. Важно, чтобы партии были не повторяющимеся, будем начинать их различными дебютами. Чтобы не делать совсем случайные ходы в дебюте, отбираем все ходы, которые не сильно хуже лучшего, задаем каждому ходу вес, например, i ход имеет вес 1/(1+i), и выбираем ход случайно пропорционально весу. Интересно, что можно использовать такой метод, если нужно специально ослабить движок для игры с человеком, но чтобы он не делал совсем случайные ходы. Пример генерации дебютов:
```
$ go run ./cmd/utils opening
```
Генерация датасета:
```
$ go run ./cmd/utils dataset -help
```
### Обучение
Нужно избегать обучаться на позициях в которых есть тактика, чтобы сеть не выдумывала бесполезные признаки, а тактику хорошо решает перебор. Например, пропускаем позиции, в которых лучший ход - взятие.
Обучение реализовано вручную, без сторонних библиотек. Позволяет продемонстрировать градиентный спуск, а также минимизирует размер обучающей выборки в оперативной памяти.
```
$ go run ./cmd/utils train -help
```
## Ссылки
- [talkchess](http://talkchess.com/forum3/viewforum.php?f=12)
- [Chess Programming Wiki](https://www.chessprogramming.org)
- [Bruce Moreland's Programming Topics](https://web.archive.org/web/20071026090003/http://www.brucemo.com/compchess/programming/index.htm)
- [SIMD библиотека для golang](https://github.com/tphakala/simd)
